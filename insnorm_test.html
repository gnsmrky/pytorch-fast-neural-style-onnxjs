<html>
<title>PyTorch fast-neural-style running in web browser</title>

<script src="https://cdn.jsdelivr.net/npm/onnxjs@0.1.4/dist/onnx.min.js"></script>

<body>
ONNX.js <b>instance_norm</b> op test.

<script>
    const sess = new onnx.InferenceSession({backendHint: 'webgl'});

    sess.loadModel("./onnx_models/insnorm_test_128x128.onnx").then(()=>{
    
    const n = 4;
    const x = new Float32Array(1*n*128*128);

    for (i=0; i<1*n*128*128; i++) {
        x[i] = i + 1.01;
    }

    const inputT = new onnx.Tensor(x, 'float32', [1,n,128,128]);

    sess.run([inputT]).then(output=>{
        const outputT = output.values().next().value;

        //console.log(`model output tensor: ${outputT.data}.`);
        console.log(`model output tensor size: ${outputT.size}`);
        console.log('data:' + outputT.data[0]);
        console.log('data:' + outputT.data[2]);
        console.log('data:' + outputT.data[3]);
        console.log('data:' + outputT.data[4]);
        console.log('data:' + outputT.data[5]);
        
        const newLine = "<br/>";//String.fromCharCode(13, 10);
        logOutput.innerHTML = "test 10" + newLine;

        var i=0;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        
        /*
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        */

        /*
        var i=1*n*128-8;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        logOutput.innerHTML += "data[" + i + "]: " + outputT.data[i] + newLine;  i++;
        */
        });
    });
</script>

<div id='logOutput'></div>

</body>
</html>

